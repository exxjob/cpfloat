<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CPFloat: Custom-Precision Floating-point numbers &mdash; CPFloat latest documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/collapsible-lists/css/tree_view.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="CPFloat API" href="cpfloat/cpfloat_root.html" />
    <link rel="prev" title="CPFloat documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> CPFloat
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">CPFloat documentation</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">CPFloat: Custom-Precision Floating-point numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mex-interface">MEX interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="#auto-tuning">Auto-tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#validation">Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#documentation">Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#experiments">Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="#references">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id9">Licensing information</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cpfloat/cpfloat_root.html">CPFloat API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CPFloat</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>CPFloat: Custom-Precision Floating-point numbers</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/readme.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cpfloat-custom-precision-floating-point-numbers">
<h1>CPFloat: Custom-Precision Floating-point numbers<a class="headerlink" href="#cpfloat-custom-precision-floating-point-numbers" title="Permalink to this headline"></a></h1>
<p>CPFloat is a header-only C library for simulating low-precision floating-point number formats in software. The library provides a set of routines for converting the elements of <code class="docutils literal notranslate"><span class="pre">float</span></code> or <code class="docutils literal notranslate"><span class="pre">double</span></code> arrays to lower precision using a variety of rounding modes. The low-precision format (target format) follows a straightforward extension of the IEEE 754 standard, and is assumed to be entirely specified by three parameters:</p>
<ul class="simple">
<li><p>a positive integer <em>p</em>, which represents the number of digits of precision;</p></li>
<li><p>a positive integer <em>e</em><span class="raw-html-m2r"><sub>max</sub></span>, which represents the maximum supported exponent; and</p></li>
<li><p>a Boolean variable σ set to <strong>true</strong> if subnormal are supported and to <strong>false</strong> otherwise.</p></li>
</ul>
<p>The largest values of <em>p</em> and <em>e</em><span class="raw-html-m2r"><sub>max</sub></span> that can be used depend on the format in which the converted numbers are to be stored (storage format). A more extensive description of the characteristics of the low-precision formats that can be used, together with more details on the choice of the admissible values of <em>p</em>, <em>e</em><span class="raw-html-m2r"><sub>max</sub></span>, and <em>σ</em> can be found in <a class="reference external" href="#ref1">[1]</a>.</p>
<p>As the library was originally intended as a faster version of the MATLAB function <code class="docutils literal notranslate"><span class="pre">chop</span></code>, <a class="reference external" href="https://github.com/higham/chop">available on GitHub</a> <a class="reference external" href="#ref2">[2]</a>, a MEX interface to CPFloat is provided in the <code class="docutils literal notranslate"><span class="pre">mex/</span></code> folder.</p>
</section>
<section id="dependencies">
<h1>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline"></a></h1>
<p>The only (optional) dependency of CPFloat is the header file <code class="docutils literal notranslate"><span class="pre">pcg_variants.h</span></code> from the <a class="reference external" href="https://github.com/imneme/pcg-c">C implementation</a> of the <a class="reference external" href="https://www.pcg-random.org/">PCG Library</a>, which provides a variety of high-quality pseudo-random number generators. For an in-depth discussion of the algorithms underlying this software, we recommend reading the <a class="reference external" href="https://www.pcg-random.org/paper.html">paper</a> by <a class="reference external" href="https://www.cs.hmc.edu/~oneill/">Melissa O’Neill</a> <a class="reference external" href="#ref3">[3]</a>, author of the library. If the file <code class="docutils literal notranslate"><span class="pre">pcg_variants.h</span></code> is not included at compile-time with the <code class="docutils literal notranslate"><span class="pre">--include</span></code> compiler option, then CPFloat relies on the default C pseudo-random number generator.</p>
<p>The PCG Library is free software (see the <a class="reference external" href="#licensing-information">Licensing information</a> below), and its generators are more efficient, reliable, and flexible than any combination of the functions <code class="docutils literal notranslate"><span class="pre">srand</span></code>,<code class="docutils literal notranslate"><span class="pre">rand</span></code>, and <code class="docutils literal notranslate"><span class="pre">rand_r</span></code> from the C standard library. We see no reason not to use it, and a warning is issued at compile time if the location of <code class="docutils literal notranslate"><span class="pre">pcg_variant.h</span></code> is not specified correctly.</p>
<p>Compiling the MEX interface requires a reasonably recent version of MATLAB or Octave, and testing the interface requires the function <code class="docutils literal notranslate"><span class="pre">float_params</span></code>, which is <a class="reference external" href="https://github.com/higham/float_params">available on GitHub</a>. The unit tests for the C implementation in <code class="docutils literal notranslate"><span class="pre">test/cpfloat_test.ts</span></code> require the <a class="reference external" href="https://libcheck.github.io/check">check unit testing framework for C</a>, including the <code class="docutils literal notranslate"><span class="pre">checkmk</span></code> script.</p>
<p>The code in the <code class="docutils literal notranslate"><span class="pre">experiments/</span></code> folder can be used to replicate the experiments discussed in <a class="reference external" href="#ref1">[1]</a>. The C experiments require the <a class="reference external" href="https://www.mpfr.org/">GNU MPFR library</a> and the <a class="reference external" href="https://github.com/oprecomp/FloatX">FloatX library</a>. The MATLAB experiments depend on the <a class="reference external" href="https://github.com/higham/chop">chop function</a> and on the <a class="reference external" href="https://gerard-meurant.pagesperso-orange.fr/floatp.zip">FLOATP_Toolbox</a>.</p>
<p>All the dependencies can be installed automatically by issuing</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make init</span>
</pre></div>
</div>
<p>If necessary, this Makefile target clones the submodules in the <code class="docutils literal notranslate"><span class="pre">include/</span></code> directory and downloads the latest version of the <a class="reference external" href="https://gerard-meurant.pagesperso-orange.fr/floatp.zip">FLOATP_Toolbox</a> from the website of the author.</p>
</section>
<section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline"></a></h1>
<p>CPFloat is a header-only library, and can be used as long as the files in <code class="docutils literal notranslate"><span class="pre">src/</span></code> are in the include path of the compiler. In order to use the PCG Library, one can either:</p>
<ul>
<li><p>specify the path of the file <code class="docutils literal notranslate"><span class="pre">pcg_variants.h</span></code> using the preprocessor option <code class="docutils literal notranslate"><span class="pre">--include</span></code> (currently used in the <a class="reference external" href="Makefile">Makefile</a>, see the variable <code class="docutils literal notranslate"><span class="pre">CFLAGS</span></code> for an example); or</p></li>
<li><p>make sure that <code class="docutils literal notranslate"><span class="pre">pcg_variants.h</span></code> is in the include path and uncomment the preprocessor instruction on line 24 of <code class="docutils literal notranslate"><span class="pre">src/cpfloat_definitions.h</span></code>, that is,</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* #include &quot;pcg_variants.h&quot; */</span><span class="w"></span>
</pre></div>
</div>
</li>
</ul>
<section id="mex-interface">
<h2>MEX interface<a class="headerlink" href="#mex-interface" title="Permalink to this headline"></a></h2>
<p>The MEX interface can be compiled automatically with either</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make mexmat # Compile MEX interface for MATLAB.</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make mexoct # Compile MEX interface for Octave.</span>
</pre></div>
</div>
<p>These two commands compile and autotune the MEX interface in MATLAB and Octave, respectively, by using the functions <code class="docutils literal notranslate"><span class="pre">mex/cpfloat_compile.m</span></code> and <code class="docutils literal notranslate"><span class="pre">mex/cpfloat_autotune.m</span></code>.</p>
<p>On a system where the <code class="docutils literal notranslate"><span class="pre">make</span></code> build automation tool is not available, we recommend building the MEX interface by running the script <code class="docutils literal notranslate"><span class="pre">cpfloat_compile_nomake.m</span></code> in the <code class="docutils literal notranslate"><span class="pre">mex/</span></code> folder. The script attempts to download the file <code class="docutils literal notranslate"><span class="pre">pcg_variants.h</span></code>  and to compile and auto-tune the MEX interface using the default C compiler. A different compiler can be used by setting the value of the variable <code class="docutils literal notranslate"><span class="pre">compilerpath</span></code> appropriately.</p>
<p>If the PCG Library header file cannot be downloaded and is not already present in the <code class="docutils literal notranslate"><span class="pre">include/pcg-c/include</span></code> folder, then the interface falls back to the pseudo-random number generator in the C standard library. If the compiler does not support OpenMP, only the sequential version of the algorithm will be produced and no auto-tuning will take place.</p>
</section>
<section id="auto-tuning">
<h2>Auto-tuning<a class="headerlink" href="#auto-tuning" title="Permalink to this headline"></a></h2>
<p>CPFloat provides a sequential and a parallel implementation of the rounding functions. Because of some overhead due to the use of OpenMP, using a single thread is typically faster for arrays with few elements, and the library provides a facility to switch between the single-threaded and the multi-threaded variants automatically, depending on the size of the input. The threshold is machine-dependent, and the best value for a given system can be found by invoking</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make autotune</span>
</pre></div>
</div>
<p>which compiles the file <code class="docutils literal notranslate"><span class="pre">src/cpfloat_autotune.c</span></code>, runs it, and updates the files <code class="docutils literal notranslate"><span class="pre">src/cpfloat_threshold_binary32.h</span></code> and <code class="docutils literal notranslate"><span class="pre">src/cpfloat_threshold_binary64.h</span></code>.</p>
</section>
<section id="validation">
<h2>Validation<a class="headerlink" href="#validation" title="Permalink to this headline"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">test/</span></code> folder contains two sets of test, one for the C library and one for the MEX interface. The unit tests for the C implementation require the <code class="docutils literal notranslate"><span class="pre">check</span></code> library, and can be run with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make ctest</span>
</pre></div>
</div>
<p>which generates the file <code class="docutils literal notranslate"><span class="pre">test/cpfloat_test.c</span></code> from <code class="docutils literal notranslate"><span class="pre">test/cpfloat_test.ts</span></code>, compiles it, and runs the tests. The Makefile target <code class="docutils literal notranslate"><span class="pre">coverage</span></code> measures the code coverage using GNU <code class="docutils literal notranslate"><span class="pre">gcov</span></code> on the same set of tests.</p>
<p>The MEX interface can be tested by using either</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make mtest # Test MEX interface using MATLAB.</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make otest # Test MEX interface using Octave.</span>
</pre></div>
</div>
<p>These two commands run, in MATLAB and Octave respectively,
the function <code class="docutils literal notranslate"><span class="pre">test/cpfloat_test.m</span></code>, a test set based on the MATLAB <code class="docutils literal notranslate"><span class="pre">test_chop.m</span></code> function, <a class="reference external" href="https://github.com/higham/chop/blob/master/test_chop.m">available on GitHub</a>, which we modified to make compatible with Octave.</p>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline"></a></h2>
<p>The documentation of CPFloat can be generated with the command</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make docs</span>
</pre></div>
</div>
<p>which relies on <a class="reference external" href="https://www.doxygen.nl/">Doxygen</a> to format the Javadoc-style comments in the source files. The HTML versions of the documentation is generated in the <code class="docutils literal notranslate"><span class="pre">docs/html/</span></code> folder.</p>
</section>
</section>
<section id="experiments">
<h1>Experiments<a class="headerlink" href="#experiments" title="Permalink to this headline"></a></h1>
<p>All the tests in <a class="reference external" href="#ref1">[1]</a> can be reproduced using the command</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make experiments</span>
</pre></div>
</div>
<p>provided that all the relevant dependencies are installed as discussed in the <a class="reference external" href="#dependencies">Dependencies section</a> above and the MEX interface has been compiled.</p>
</section>
<section id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this headline"></a></h1>
<p><span class="raw-html-m2r"><a name="ref1">[1]</a></span> Massimiliano Fasi and Mantas Mikaitis. <a class="reference external" href="http://eprints.maths.manchester.ac.uk/2785">CPFloat: A C library for emulating low-precision arithmetic</a>. MIMS EPrint 2020.22, Manchester Institute for Mathematical Sciences, The University of Manchester, UK, October 2020.</p>
<p><span class="raw-html-m2r"><a name="ref2">[2]</a></span> Nicholas J. Higham and Srikara Pranesh, <a class="reference external" href="https://doi.org/10.1137/19M1251308">Simulating Low Precision Floating-Point Arithmetic</a>, SIAM J. Sci. Comput., 41, C585-C602, 2019.</p>
<p><span class="raw-html-m2r"><a name="ref3">[3]</a></span> Melissa E. O’Neill, <a class="reference external" href="https://www.pcg-random.org/paper.html">PCG: A family of simple fast space-efficient statistically good algorithms for random number generation</a>, Technical report HMC-CS-2014-0905, Harvey Mudd College, Claremont, CA, September 2014.</p>
</section>
<section id="id9">
<h1>Licensing information<a class="headerlink" href="#id9" title="Permalink to this headline"></a></h1>
<p>CPFloat is distributed under the GNU Lesser General Public License, Version 2.1 or later. The terms of the GNU General Public License, Version 2, and of the Lesser GNU General Public License, Version 2.1, are in the <a class="reference external" href="LICENSES">LICENSES</a> folder. Please contact us if you would like to use CPFloat in an open source project distributed under the terms of a license that is incompatible with the GNU LGPL. We might be able to relicense the software for you.</p>
<p>The PCG Library is distributed under the terms of either the <a class="reference external" href="https://raw.githubusercontent.com/imneme/pcg-c/master/LICENSE-APACHE.txt">Apache License, Version 2.0</a> or the <a class="reference external" href="https://raw.githubusercontent.com/imneme/pcg-c/master/LICENSE-MIT.txt">Expat License</a>, at the option of the user.</p>
<p>The MATLAB function <code class="docutils literal notranslate"><span class="pre">float_params</span></code> is distributed under the terms of the <a class="reference external" href="https://raw.githubusercontent.com/higham/float_params/master/license.txt">BSD 2-Clause “Simplified” License</a>.</p>
<p>The GNU MPFR Library is distributed under the terms of the <a class="reference external" href="https://www.gnu.org/licenses/lgpl-3.0.html">GNU Lesser General Public License (GNU Lesser GPL), Version 3</a> or later (<a class="reference external" href="https://www.gnu.org/licenses/old-licenses/lgpl-2.1.html">Version 2.1</a> or later for MPFR versions until 2.4.x).</p>
<p>The FloatX Library is distributed under the terms of the <a class="reference external" href="https://raw.githubusercontent.com/oprecomp/FloatX/master/LICENSE">Apache License, Version 2.0</a>.</p>
<p>The MATLAB function <code class="docutils literal notranslate"><span class="pre">chop</span></code> is distributed under the terms of the <a class="reference external" href="https://raw.githubusercontent.com/higham/chop/master/license.txt">BSD 2-Clause “Simplified” License</a>.</p>
<p>The FLOATP Toolbox is distributed under an informal license and without any warranty.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="CPFloat documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cpfloat/cpfloat_root.html" class="btn btn-neutral float-right" title="CPFloat API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Massimiliano Fasi and Mantas Mikaitis.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>